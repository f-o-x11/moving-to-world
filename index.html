<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Moving.to - Find Your Perfect City</title>
    <meta name="description" content="Search and filter 32,496 cities worldwide by population, cost of living, climate, and more. Find your perfect place to move.">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .header { text-align: center; color: white; padding: 40px 20px; }
        .header h1 { font-size: 3rem; margin-bottom: 10px; }
        .header p { font-size: 1.2rem; opacity: 0.9; }
        
        .search-card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            margin-bottom: 30px;
        }
        
        .search-box {
            width: 100%;
            padding: 15px 20px;
            font-size: 1.1rem;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            margin-bottom: 20px;
        }
        .search-box:focus { outline: none; border-color: #667eea; }
        
        .filters {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .filter-group {
            background: #f7fafc;
            padding: 15px;
            border-radius: 10px;
        }
        .filter-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #2d3748;
        }
        .filter-group select, .filter-group input {
            width: 100%;
            padding: 10px;
            border: 1px solid #cbd5e0;
            border-radius: 6px;
            font-size: 0.95rem;
        }
        
        .toggle-filters {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            margin-bottom: 15px;
        }
        .toggle-filters:hover { background: #5568d3; }
        
        .filters.hidden { display: none; }
        
        .results {
            background: white;
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .result-item {
            padding: 15px;
            border-bottom: 1px solid #e2e8f0;
            cursor: pointer;
            transition: background 0.2s;
        }
        .result-item:hover { background: #f7fafc; }
        .result-item:last-child { border-bottom: none; }
        
        .result-name { font-size: 1.2rem; font-weight: 600; color: #2d3748; margin-bottom: 5px; }
        .result-location { color: #718096; font-size: 0.95rem; margin-bottom: 8px; }
        .result-stats {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            font-size: 0.9rem;
        }
        .stat {
            background: #edf2f7;
            padding: 4px 10px;
            border-radius: 6px;
            color: #4a5568;
        }
        
        .no-results {
            text-align: center;
            padding: 40px;
            color: #718096;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #667eea;
        }
        
        @media (max-width: 768px) {
            .header h1 { font-size: 2rem; }
            .filters { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üåç Find Your Perfect City</h1>
            <p>Search 32,496 cities worldwide with advanced filters</p>
        </div>
        
        <div class="search-card">
            <input type="text" class="search-box" id="searchBox" placeholder="Search by city name..." autocomplete="off">
            
            <button class="toggle-filters" id="toggleFilters">üîç Show Advanced Filters</button>
            
            <div class="filters hidden" id="filters">
                <div class="filter-group">
                    <label>Population</label>
                    <select id="populationFilter">
                        <option value="">Any size</option>
                        <option value="0-100000">Under 100K</option>
                        <option value="100000-500000">100K - 500K</option>
                        <option value="500000-1000000">500K - 1M</option>
                        <option value="1000000-5000000">1M - 5M</option>
                        <option value="5000000-999999999">Over 5M</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label>Monthly Cost (Single)</label>
                    <select id="costFilter">
                        <option value="">Any cost</option>
                        <option value="0-1000">Under $1,000</option>
                        <option value="1000-1500">$1,000 - $1,500</option>
                        <option value="1500-2000">$1,500 - $2,000</option>
                        <option value="2000-3000">$2,000 - $3,000</option>
                        <option value="3000-999999">Over $3,000</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label>Country</label>
                    <select id="countryFilter">
                        <option value="">All countries</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label>Sort By</label>
                    <select id="sortBy">
                        <option value="relevance">Relevance</option>
                        <option value="population_desc">Population (High to Low)</option>
                        <option value="population_asc">Population (Low to High)</option>
                        <option value="cost_asc">Cost (Low to High)</option>
                        <option value="cost_desc">Cost (High to Low)</option>
                        <option value="name">Name (A-Z)</option>
                    </select>
                </div>
            </div>
        </div>
        
        <div class="results">
            <div id="resultsList">
                <div class="loading">Type to search or apply filters...</div>
            </div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/fuse.js@7.0.0"></script>
    <script>
        let cityDatabase = [];
        let fuse = null;
        
        // Load city database
        fetch('/city-database.json')
            .then(r => r.json())
            .then(data => {
                cityDatabase = data;
                
                // Initialize Fuse.js for fuzzy search
                fuse = new Fuse(cityDatabase, {
                    keys: ['name', 'state', 'country'],
                    threshold: 0.3,
                    includeScore: true
                });
                
                // Populate country filter
                const countries = [...new Set(data.map(c => c.country))].sort();
                const countryFilter = document.getElementById('countryFilter');
                countries.forEach(country => {
                    const option = document.createElement('option');
                    option.value = country;
                    option.textContent = country;
                    countryFilter.appendChild(option);
                });
                
                document.getElementById('resultsList').innerHTML = '<div class="no-results">Ready to search! Try typing a city name or using filters.</div>';
            });
        
        // Toggle filters
        document.getElementById('toggleFilters').addEventListener('click', function() {
            const filters = document.getElementById('filters');
            filters.classList.toggle('hidden');
            this.textContent = filters.classList.contains('hidden') ? 'üîç Show Advanced Filters' : 'üîç Hide Filters';
        });
        
        // Search and filter function
        function performSearch() {
            const query = document.getElementById('searchBox').value.trim();
            const popFilter = document.getElementById('populationFilter').value;
            const costFilter = document.getElementById('costFilter').value;
            const countryFilter = document.getElementById('countryFilter').value;
            const sortBy = document.getElementById('sortBy').value;
            
            let results = [];
            
            // Text search
            if (query.length >= 2 && fuse) {
                results = fuse.search(query, { limit: 100 }).map(r => r.item);
            } else {
                results = [...cityDatabase];
            }
            
            // Apply filters
            if (popFilter) {
                const [min, max] = popFilter.split('-').map(Number);
                results = results.filter(c => c.population >= min && c.population <= max);
            }
            
            if (costFilter) {
                const [min, max] = costFilter.split('-').map(Number);
                results = results.filter(c => c.monthly_cost_single >= min && c.monthly_cost_single <= max);
            }
            
            if (countryFilter) {
                results = results.filter(c => c.country === countryFilter);
            }
            
            // Sort results
            switch(sortBy) {
                case 'population_desc':
                    results.sort((a, b) => b.population - a.population);
                    break;
                case 'population_asc':
                    results.sort((a, b) => a.population - b.population);
                    break;
                case 'cost_asc':
                    results.sort((a, b) => a.monthly_cost_single - b.monthly_cost_single);
                    break;
                case 'cost_desc':
                    results.sort((a, b) => b.monthly_cost_single - a.monthly_cost_single);
                    break;
                case 'name':
                    results.sort((a, b) => a.name.localeCompare(b.name));
                    break;
            }
            
            // Limit to top 50 results
            results = results.slice(0, 50);
            
            displayResults(results);
        }
        
        function displayResults(results) {
            const container = document.getElementById('resultsList');
            
            if (results.length === 0) {
                container.innerHTML = '<div class="no-results">No cities found matching your criteria. Try adjusting your filters.</div>';
                return;
            }
            
            container.innerHTML = results.map(city => `
                <div class="result-item" onclick="window.location.href='${city.url}'">
                    <div class="result-name">${city.name}</div>
                    <div class="result-location">${[city.state, city.country].filter(Boolean).join(', ')}</div>
                    <div class="result-stats">
                        <span class="stat">üë• ${formatNumber(city.population)}</span>
                        <span class="stat">üí∞ $${formatNumber(city.monthly_cost_single)}/mo</span>
                        <span class="stat">üè† $${formatNumber(city.rent_1br_center)} rent</span>
                    </div>
                </div>
            `).join('');
        }
        
        function formatNumber(num) {
            if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
            if (num >= 1000) return (num / 1000).toFixed(0) + 'K';
            return num.toString();
        }
        
        // Event listeners
        document.getElementById('searchBox').addEventListener('input', performSearch);
        document.getElementById('populationFilter').addEventListener('change', performSearch);
        document.getElementById('costFilter').addEventListener('change', performSearch);
        document.getElementById('countryFilter').addEventListener('change', performSearch);
        document.getElementById('sortBy').addEventListener('change', performSearch);
    </script>
</body>
</html>

